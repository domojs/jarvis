module.exports=function(thisIndex, transform, customNext){
	var handlers=[];

	if(!transform)
	{
		transform=function(i, arg)
		{
			return arg;
		}
	}
	
	var eval=function(){
		var state=true;
		
		var next=function(error)
		{
			if(error)
			{
				customNext(error, next.args);
				return state=false;
			}
			return state=true;
		}
		
		function loop(index, body)
		{
			body(index, function(){
				if(next.apply(this,arguments))
					loop(index+1,body);
			});
		}

		var args=[];
		
		for(var arg in arguments)
			args.push(transform(arg, arguments[arg]));

		next.args=args;
			
		loop(0, function(i,next){
			var handlerArgs=args.slice(0,handlers[i].length-1);
			handlerArgs.push(next);
			handlers[i].apply(thisIndex && arguments[thisIndex] || this, handlerArgs);
		});
	};
	
	eval.use=function(handler){
		handlers.push(handler);
	};

	
	return eval;
};